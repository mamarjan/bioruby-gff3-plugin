#! /usr/bin/ruby
#
# Author:: Pjotr Prins
# Copyright:: August 2010
# License:: Ruby License
#
# Copyright (C) 2010 Pjotr Prins <pjotr.prins@thebird.nl>


USAGE = <<EOM
  Fetch mRNAs, exons, or CDS and print as FASTA format

  gff3-fetch [--no-cache] mRNA|CDS|exon filename.gff
EOM

rootpath = File.dirname(File.dirname(__FILE__))
$: << rootpath+'/lib'

require 'bio/db/gff/gffdb'

if ARGV.size == 0
  print USAGE
end

gfftype = ARGV.shift
caching = true
if gfftype == "--no-cache"
  caching = false
  gfftype = ARGV.shift
end
raise "Unknown GFF type '#{gfftype}'" if gfftype !~ /mrna|cds|exon/i

ARGV.each do | fn |
  gffdb = Bio::GFFbrowser::GFFdb.new(fn)
  gff = gffdb.assembler
  case gfftype
    when 'mrna'||'mRNA' :
          gff.each_mRNA_seq do | id, seq |
            puts ">"+id
            puts seq
          end
    when 'exon':
          gff.each_exon_seq do | id, seq |
            puts ">"+id
            puts seq
          end
    when 'CDS':
          gff.each_CDS_seq do | id, seq |
            puts ">"+id
            puts seq
          end
    else
      raise "Unknown action <#{gfftype}>"
  end
end



